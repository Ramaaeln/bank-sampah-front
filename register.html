<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar - Bank Sampah Digital</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%)">
    <div class="form-container">
      <div style="text-align: center; margin-bottom: 2rem">
        <span style="font-size: 3rem">♻️</span>
        <h2>Daftar Bank Sampah</h2>
        <p style="color: var(--gray)">Buat akun baru untuk memulai menabung</p>
      </div>

      <div id="alert-container"></div>

      <form id="registerForm">
        <div class="form-group">
          <label for="nama">Nama Lengkap</label>
          <input
            type="text"
            id="nama"
            name="nama"
            required
            placeholder="Masukkan nama lengkap"
          />
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="contoh@email.com"
          />
        </div>

        <div class="form-group">
          <label for="no_hp">Nomor HP</label>
          <input
            type="tel"
            id="no_hp"
            name="no_hp"
            required
            placeholder="08xxxxxxxxxx"
          />
        </div>

        <div class="form-group">
          <label for="alamat">Alamat Lengkap</label>
          <textarea
            id="alamat"
            name="alamat"
            rows="3"
            required
            placeholder="Masukkan alamat lengkap"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            name="password"
            required
            placeholder="Minimal 6 karakter"
          />
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%">
          <span id="btnText">Daftar Sekarang</span>
          <span id="btnLoader" style="display: none">⏳ Memproses...</span>
        </button>
      </form>

      <div class="form-footer">
        <p>Sudah punya akun? <a href="login.html">Login di sini</a></p>
      </div>
    </div>

    <script>
      const form = document.getElementById("registerForm");
      const alertContainer = document.getElementById("alert-container");
      const btnText = document.getElementById("btnText");
      const btnLoader = document.getElementById("btnLoader");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        form.querySelector("button").disabled = true;
        btnText.style.display = "none";
        btnLoader.style.display = "inline";

        const formData = new FormData(form);

        try {
          const payload = {
            nama: document.getElementById("nama").value,
            email: document.getElementById("email").value,
            no_hp: document.getElementById("no_hp").value,
            alamat: document.getElementById("alamat").value,
            password: document.getElementById("password").value,
          };

          const response = await fetch("https://bank-sampah-rxmo.vercel.app/api/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const result = await response.json();

          if (result.success) {
            localStorage.setItem("access_token", result.data.access_token);
            showAlert("success", result.message);
            form.reset();
            setTimeout(() => (window.location.href = "dashboard.html"), 1500);
          } else {
            showAlert("error", result.message);
            form.querySelector("button").disabled = false;
            btnText.style.display = "inline";
            btnLoader.style.display = "none";
          }
        } catch (err) {
          showAlert("error", "Terjadi kesalahan. Silakan coba lagi!");
          form.querySelector("button").disabled = false;
          btnText.style.display = "inline";
          btnLoader.style.display = "none";
        }
      });

      function showAlert(type, message) {
        const alertClass = type === "success" ? "alert-success" : "alert-error";
        alertContainer.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
        setTimeout(() => (alertContainer.innerHTML = ""), 5000);
      }
    </script>
  </body>
</html>
